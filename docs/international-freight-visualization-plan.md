# 国际货运代理流程可视化项目（基于芋道）实施方案

## 1. 项目目标

围绕“询价 -> 订舱 -> 拖车/报关 -> 海运/空运在途 -> 到港清关 -> 派送 -> 对账结算”的国际货代核心链路，建设三端一体系统：

- 后台管理端：运营、客服、单证、财务、管理层使用；
- 用户门户端（Web）：B 端客户查看订单状态、费用、单据、消息；
- 移动端（UniApp）：客户与内部人员移动跟踪、节点反馈、异常上报；
- 可视化能力：订单全链路时间轴、地图轨迹、异常看板、经营分析看板。

技术底座采用芋道（Ruoyi-Vue-Pro）生态，复用其用户权限、工作流、消息、多租户、审计日志等基础能力。

---

## 2. 总体架构建议

## 2.1 端架构映射

- `ruoyi-vue-pro`：后端服务（Spring Boot + MyBatis Plus + Redis + MQ）；
- `yudao-ui-admin-vue3` 或 `yudao-ui-admin-vben`：后台管理端；
- `yudao-ui-admin-uniapp`：移动端（客户/内部轻作业）；
- 用户门户端可选：
  - 方案 A：基于 `yudao-ui-admin-vue3` 新建 portal 应用；
  - 方案 B：从 admin 抽离公共组件后独立门户前端仓。

## 2.2 业务分层

- 主数据层：客户、供应商、航线、港口、承运商、币种、费目；
- 业务层：询报价、订单、运段、箱信息、单证、费用、结算；
- 流程层：BPM 编排（审批、异常处理、改单、费用确认）；
- 可视化层：流程时间轴、地图轨迹、BI 看板、预警中心；
- 集成层：船司/航司轨迹 API、报关接口、短信邮件/企微通知、OSS 文档存储。

---

## 3. 核心业务模块拆解

## 3.1 报价与订单

- 报价单：按运输方式（海运整箱/拼箱、空运）定义费项模板；
- 订单创建：支持由报价单一键转订单；
- 订单状态机：待确认、执行中、异常中、已完成、已关闭。

建议字段：

- 基础信息：委托号、客户参考号、贸易条款、起运港/目的港；
- 运力信息：船名航次/航班、提单号、箱型箱量、件毛体；
- 时间节点：截关、开船、到港、提货、签收；
- 风险标签：延误、甩柜、查验、费用争议。

## 3.2 节点追踪与流程可视化（重点）

将“订单 -> 运段 -> 节点”建模为可视化主线：

- 运段：提货段、干线段、清关段、派送段；
- 节点：每段里定义标准里程碑（已订舱、已放舱单、已报关、已装船...）；
- 节点事件：时间、责任方、凭证、备注、异常标记。

前端展示：

- 时间轴：按节点状态展示“完成/进行中/延迟”；
- 地图轨迹：关键港口/机场/仓库坐标连线；
- 异常聚合：按延误类型、航线、客户、责任部门分组。

## 3.3 单证中心

- 单证类型：提单、装箱单、发票、报关单、放货通知；
- 文档生命周期：上传 -> 审核 -> 归档 -> 外部共享；
- 文档关联：与订单、节点、费用记录做强关联。

## 3.4 费用与结算

- 应收应付台账：支持多币种与汇率快照；
- 账单确认：客户在线确认/驳回；
- 对账与发票：月结客户自动生成账单周期。

---

## 4. 权限与租户设计

- 多租户：按货代公司/分子公司隔离；
- 角色建议：销售、客服、操作、单证、财务、管理员、客户管理员、客户只读；
- 数据权限：
  - 客户仅看自己公司订单；
  - 内部按部门或航线维度授权；
  - 财务与经营看板可按组织层级下钻。

---

## 5. 技术实现建议（基于芋道）

## 5.1 后端（ruoyi-vue-pro）

建议新增模块（`yudao-module-logistics`）：

- `logistics-order`：订单主表/子表、状态机服务；
- `logistics-tracking`：节点模板、节点事件、轨迹同步任务；
- `logistics-doc`：单证管理与文件权限；
- `logistics-settlement`：应收应付、账单、汇率、对账；
- `logistics-dashboard`：看板聚合查询接口。

推荐配套：

- 定时任务：轨迹同步、异常超时扫描；
- 消息通知：站内信 + 短信/邮件（关键节点触达）；
- BPM：费用审批、异常处理、放单审批。

## 5.2 前端

后台管理端：

- 订单工作台：筛选、批量操作、异常处理；
- 可视化大屏：运输态势、时效达成率、异常热力图；
- 单证与费用协同页面。

用户门户端：

- 我的订单、轨迹时间轴、账单中心、消息中心；
- 对账确认与在线提问（订单留言流）。

移动端（UniApp）：

- 节点快捷回传（拍照+定位+备注）；
- 异常上报（延误/查验/改港）；
- 消息提醒与待办。

---

## 6. 可视化指标体系（第一版）

- 履约时效：准班率、平均在途时长、节点超时率；
- 异常指标：异常单占比、异常关闭时长、重复异常率；
- 客户维度：客户活跃度、复购率、投诉率；
- 财务维度：毛利率、单票利润、应收账龄、回款周期。

建议先做 10~15 个高频指标，优先支持“按客户/航线/月份”钻取。

---

## 7. 分阶段落地路线

- Phase 1（4~6 周）：
  - 订单 + 节点时间轴 + 客户门户查询 + 基础消息通知；
- Phase 2（4~6 周）：
  - 单证中心 + 费用对账 + 移动端节点回传；
- Phase 3（4~8 周）：
  - 地图轨迹 + 经营看板 + 异常预测（规则引擎）。

里程碑验收标准：

- 客户可自助查询 90% 订单状态；
- 关键节点人工反馈时延 < 30 分钟；
- 异常单平均处理时长下降 20%+。

---

## 8. 你可以马上开始的任务清单

1. 梳理你的目标业务流程（海运/空运、整箱/拼箱是否都做）；
2. 明确一期必须上线的 8~10 个核心节点；
3. 定义订单与节点数据模型（先字段后页面）；
4. 在芋道中创建 `yudao-module-logistics` 骨架；
5. 先打通“下单 -> 节点更新 -> 门户可见 -> 消息提醒”的最小闭环。

如果你愿意，我下一步可以直接给你：

- 一份可落地的 MySQL 表结构（订单/节点/单证/费用）；
- 对应后端接口清单（按 Controller 列出）；
- 前端页面路由与菜单结构（后台/门户/移动端）。
